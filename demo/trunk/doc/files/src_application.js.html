<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/application.js - dwv</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="dwv"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.0beta</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Data reader.html">Data reader</a></li>
            
                <li><a href="../classes/DICOM tag dictionary..html">DICOM tag dictionary.</a></li>
            
                <li><a href="../classes/DicomParser class..html">DicomParser class.</a></li>
            
                <li><a href="../classes/dwv.math.Circle.html">dwv.math.Circle</a></li>
            
                <li><a href="../classes/dwv.math.Draw circle command..html">dwv.math.Draw circle command.</a></li>
            
                <li><a href="../classes/dwv.math.Drawing tool..html">dwv.math.Drawing tool.</a></li>
            
                <li><a href="../classes/dwv.math.FastPoint2D.html">dwv.math.FastPoint2D</a></li>
            
                <li><a href="../classes/dwv.math.Line shape..html">dwv.math.Line shape.</a></li>
            
                <li><a href="../classes/dwv.math.Path shape..html">dwv.math.Path shape.</a></li>
            
                <li><a href="../classes/dwv.math.Point2D.html">dwv.math.Point2D</a></li>
            
                <li><a href="../classes/dwv.math.Rectangle shape..html">dwv.math.Rectangle shape.</a></li>
            
                <li><a href="../classes/dwv.math.Region Of Interest shape.
Note: should be a closed path..html">dwv.math.Region Of Interest shape.
Note: should be a closed path.</a></li>
            
                <li><a href="../classes/Filter classes..App
Main application..html">Filter classes..App
Main application.</a></li>
            
                <li><a href="../classes/Filter classes..Draw line command..html">Filter classes..Draw line command.</a></li>
            
                <li><a href="../classes/Filter classes..Draw livewire command..html">Filter classes..Draw livewire command.</a></li>
            
                <li><a href="../classes/Filter classes..Draw rectangle command..html">Filter classes..Draw rectangle command.</a></li>
            
                <li><a href="../classes/Filter classes..Draw ROI command..html">Filter classes..Draw ROI command.</a></li>
            
                <li><a href="../classes/Filter classes..Filter tool..html">Filter classes..Filter tool.</a></li>
            
                <li><a href="../classes/Filter classes..Livewire painting tool..html">Filter classes..Livewire painting tool.</a></li>
            
                <li><a href="../classes/Filter classes..Run filter command..html">Filter classes..Run filter command.</a></li>
            
                <li><a href="../classes/Filter classes..Sharpen filter tool..html">Filter classes..Sharpen filter tool.</a></li>
            
                <li><a href="../classes/Filter classes..Sobel filter tool..html">Filter classes..Sobel filter tool.</a></li>
            
                <li><a href="../classes/Filter classes..Threshold filter tool..html">Filter classes..Threshold filter tool.</a></li>
            
                <li><a href="../classes/Filter classes..Tool box..html">Filter classes..Tool box.</a></li>
            
                <li><a href="../classes/Filter classes..UndoStack class..html">Filter classes..UndoStack class.</a></li>
            
                <li><a href="../classes/Filter classes..WindowLevel tool: handle window/level related events..html">Filter classes..WindowLevel tool: handle window/level related events.</a></li>
            
                <li><a href="../classes/Filter classes..Zoom class..html">Filter classes..Zoom class.</a></li>
            
                <li><a href="../classes/GUI classes..Circular Bucket Queue.

Returns input&#x27;d points in sorted order. All operations run in roughly O(1)
time (for input with small cost values), but it has a strict requirement:

If the most recent point had a cost of c, any points added should have a cost
c&#x27; in the range c &lt;= c&#x27; &lt;= c + (capacity - 1)..html">GUI classes..Circular Bucket Queue.

Returns input&#x27;d points in sorted order. All operations run in roughly O(1)
time (for input with small cost values), but it has a strict requirement:

If the most recent point had a cost of c, any points added should have a cost
c&#x27; in the range c &lt;= c&#x27; &lt;= c + (capacity - 1).</a></li>
            
                <li><a href="../classes/GUI classes..Image class..html">GUI classes..Image class.</a></li>
            
                <li><a href="../classes/GUI classes..Image Size class. 
Supports 2D and 3D images..html">GUI classes..Image Size class. 
Supports 2D and 3D images.</a></li>
            
                <li><a href="../classes/GUI classes..Image Spacing class. 
Supports 2D and 3D images..html">GUI classes..Image Spacing class. 
Supports 2D and 3D images.</a></li>
            
                <li><a href="../classes/GUI classes..Rescale LUT class..html">GUI classes..Rescale LUT class.</a></li>
            
                <li><a href="../classes/GUI classes..Scissors.

Ref: Eric N. Mortensen, William A. Barrett, Interactive Segmentation with
  Intelligent Scissors, Graphical Models and Image Processing, Volume 60,
  Issue 5, September 1998, Pages 349-384, ISSN 1077-3169,
  DOI: 10.1006/gmip.1998.0480.

(http://www.sciencedirect.com/science/article/B6WG4-45JB8WN-9/2/6fe59d8089fd1892c2bfb82283065579)

Highly inspired from http://code.google.com/p/livewire-javascript/.html">GUI classes..Scissors.

Ref: Eric N. Mortensen, William A. Barrett, Interactive Segmentation with
  Intelligent Scissors, Graphical Models and Image Processing, Volume 60,
  Issue 5, September 1998, Pages 349-384, ISSN 1077-3169,
  DOI: 10.1006/gmip.1998.0480.

(http://www.sciencedirect.com/science/article/B6WG4-45JB8WN-9/2/6fe59d8089fd1892c2bfb82283065579)

Highly inspired from http://code.google.com/p/livewire-javascript/</a></li>
            
                <li><a href="../classes/GUI classes..Style class..html">GUI classes..Style class.</a></li>
            
                <li><a href="../classes/GUI classes..View class..html">GUI classes..View class.</a></li>
            
                <li><a href="../classes/GUI classes..Window layer..html">GUI classes..Window layer.</a></li>
            
                <li><a href="../classes/GUI classes..Window LUT class..html">GUI classes..Window LUT class.</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/dwv.html">dwv</a></li>
            
                <li><a href="../modules/math.html">math</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/application.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//! @namespace Main DWV namespace.
var dwv = dwv || {};
 
/**
* @class App
* Main application.
*/
dwv.App = function(mobile)
{
    // Local object
    var self = this;
    // Image
    var image = null;
    var view = null;
    // Original image
    var originalImage = null;
    // Image data array
    var imageData = null;
    var dataWidth = 0;
    var dataHeight = 0;
    var displayZoom = 1;
     
    // Image layer
    var imageLayer = null;
    // Draw layer
    var drawLayer = null;
    // Temporary layer
    var tempLayer = null;
    
    // flag to know if the info layer is listening on the image.
    var isInfoLayerListening = true;
    
    // Tool box
    var toolBox = new dwv.tool.ToolBox(this);
    // UndoStack
    var undoStack = new dwv.tool.UndoStack(this);
    
    // Public Methods
    // --------------
    
    // Get the image
    this.getImage = function() { return image; };
    // Get the view
    this.getView = function() { return view; };
    
    // Set the image
    this.setImage = function(img) { image = img; view.setImage(img); };    
    // Restore the original image
    this.restoreOriginalImage = function() { image = originalImage; view.setImage(originalImage); }; 
    
    // Get the image data array
    this.getImageData = function() { return imageData; };

    // Get the tool box
    this.getToolBox = function() { return toolBox; };

    // Get the image layer
    this.getImageLayer = function() { return imageLayer; };
    // Get the draw layer
    this.getDrawLayer = function() { return drawLayer; };
    // Get the temporary layer
    this.getTempLayer = function() { return tempLayer; };

    // Get the image details
    this.getUndoStack = function() { return undoStack; };

    /**
     * Initialise the HTML for the application.
     */
    this.init = function()
    {
        // bind open files with method
        document.getElementById(&#x27;imagefiles&#x27;).addEventListener(&#x27;change&#x27;, this.onChangeFiles, false);
        document.getElementById(&#x27;imageurl&#x27;).addEventListener(&#x27;change&#x27;, this.onChangeURL, false);
    };
    
    this.reset = function()
    {
        image = null;
        view = null;
        undoStack = new dwv.tool.UndoStack(this);
    };
    
    /**
     * Handle key event.
     * - CRTL-Z: undo
     * - CRTL-Y: redo
     * Default behavior. Usually used in tools. 
     * @param event
     */
    this.handleKeyDown = function(event)
    {
        if( event.keyCode === 90 &amp;&amp; event.ctrlKey ) // ctrl-z
        {
            self.getUndoStack().undo();
        }
        else if( event.keyCode === 89 &amp;&amp; event.ctrlKey ) // ctrl-y
        {
            self.getUndoStack().redo();
        }
    };
    
    /**
     * @public
     */
    this.onChangeFiles = function(evt)
    {
        self.loadFiles(evt.target.files);
    };

    /**
     * @public
     */
    this.loadFiles = function(files) 
    {
        // Image loader
        var onLoadImage = function(event){
            try {
                // parse image file
                var data = dwv.image.getDataFromImage(this);
                if( image ) image.appendSlice( data.view.getImage() );
                // prepare display
                postLoadInit(data);
            } catch(error) {
                handleError(error);
                return;
            }
        };
        
        // Image reader loader
        var onLoadImageReader = function(event){
            var theImage = new Image();
            theImage.src = event.target.result;
            // storing values to pass them on
            theImage.file = this.file;
            theImage.index = this.index;
            theImage.onload = onLoadImage;
        };
        // Image reader error handler
        var onErrorImageReader = function(event){
            alert(&quot;An error occurred while reading the image file: &quot;+event.getMessage());
        };
        
        // DICOM reader loader
        var onLoadDicomReader = function(event){
            try {
                // parse DICOM file
                var data = dwv.image.getDataFromDicomBuffer(event.target.result);
                if( image ) image.appendSlice( data.view.getImage() );
                // prepare display
                postLoadInit(data);
            } catch(error) {
                handleError(error);
                return;
            }
        };
        // DICOM reader error handler
        var onErrorDicomReader = function(event){
            alert(&quot;An error occurred while reading the DICOM file: &quot;+event.getMessage());
        };
        
        // main load loop
        this.reset();
        for (var i = 0; i &lt; files.length; ++i)
        {
            var file = files[i];
            var reader = new FileReader();
            if( file.type.match(&quot;image.*&quot;) )
            {
                // storing values to pass them on
                reader.file = file;
                reader.index = i;
                reader.onload = onLoadImageReader;
                reader.onprogress = dwv.gui.updateProgress;
                reader.onerror = onErrorImageReader;
                reader.readAsDataURL(file);
            }
            else
            {
                reader.onload = onLoadDicomReader;
                reader.onprogress = dwv.gui.updateProgress;
                reader.onerror = onErrorDicomReader;
                reader.readAsArrayBuffer(file);
            }
        }
    };
        
    /**
     * @public
     */
    this.onChangeURL = function(evt)
    {
        self.loadURL(evt.target.value);
    };

    /**
     * @public
     */
    this.loadURL = function(urls) 
    {
        // Image loader
        var onLoadImage = function(event){
            try {
                // parse image data
                var data = dwv.image.getDataFromImage(this);
                if( image ) image.appendSlice( data.view.getImage() );
                // prepare display
                postLoadInit(data);
            } catch(error) {
                handleError(error);
                return;
            }
        };
        
        // Request handler
        var onLoadRequest = function(event) {
            var view = new DataView(this.response);
            var isJpeg = view.getUint32(0) === 0xffd8ffe0;
            var isPng = view.getUint32(0) === 0x89504e47;
            var isGif = view.getUint32(0) === 0x47494638;
            if( isJpeg || isPng || isGif ) {
                // image data
                var theImage = new Image();

                var bytes = new Uint8Array(this.response);
                var binary = &#x27;&#x27;;
                for (var i = 0; i &lt; bytes.byteLength; ++i) {
                    binary += String.fromCharCode(bytes[i]);
                }
                var imgStr = &quot;unknown&quot;;
                if (isJpeg) imgStr = &quot;jpeg&quot;;
                else if (isPng) imgStr = &quot;png&quot;;
                else if (isGif) imgStr = &quot;gif&quot;;
                theImage.src = &quot;data:image/&quot; + imgStr + &quot;;base64,&quot; + window.btoa(binary);
                
                theImage.onload = onLoadImage;
            }
            else {
                try {
                    // parse DICOM
                    var data = dwv.image.getDataFromDicomBuffer(this.response);
                    if( image ) image.appendSlice( data.view.getImage() );
                    // prepare display
                    postLoadInit(data);
                } catch(error) {
                    handleError(error);
                    return;
                }
            }
        };
        // Request error handler
        var onErrorRequest = function(event){
            alert(&quot;An error occurred while retrieving the file: (http) &quot;+this.status);
        };
        
        // main load loop
        this.reset();
        for (var i = 0; i &lt; urls.length; ++i)
        {
            var url = urls[i];
            var request = new XMLHttpRequest();
            // TODO Verify URL...
            request.open(&#x27;GET&#x27;, url, true);
            request.responseType = &quot;arraybuffer&quot;; 
            request.onload = onLoadRequest;
            request.onerror = onErrorRequest;
            request.onprogress = dwv.gui.updateProgress;
            request.send(null);
        }
    };
    
    /**
     * Generate the image data and draw it.
     */
    this.generateAndDrawImage = function()
    {         
        // generate image data from DICOM
        self.getView().generateImageData(imageData);         
        // set the image data of the layer
        self.getImageLayer().setImageData(imageData);
        // draw the image
        self.getImageLayer().draw();
    };
    
    /**
     * To be called once the image is loaded.
     */
    this.resize = function()
    {
        // adapt the size of the layer container
        var mainWidth = 0;
        var mainHeight = 0;
        if( mobile ) {
            mainWidth = $(window).width();
            mainHeight = $(window).height() - 125;
        }
        else {
            mainWidth = $(&#x27;#pageMain&#x27;).width() - 360;
            mainHeight = $(&#x27;#pageMain&#x27;).height() - 75;
        }
        displayZoom = Math.min( (mainWidth / dataWidth), (mainHeight / dataHeight) );
        $(&quot;#layerContainer&quot;).width(parseInt(displayZoom*dataWidth, 10));
        $(&quot;#layerContainer&quot;).height(parseInt(displayZoom*dataHeight, 10));
    };
    
    /**
     * To be called once the image is loaded.
     */
    this.setLayersZoom = function(zoomX,zoomY,cx,cy)
    {
        if( imageLayer ) imageLayer.zoom(zoomX,zoomY,cx,cy);
        if( drawLayer ) drawLayer.zoom(zoomX,zoomY,cx,cy);
    };
    
    /**
     * Toggle the display of the info layer.
     */
    this.toggleInfoLayerDisplay = function()
    {
        // toggle html
        dwv.html.toggleDisplay(&#x27;infoLayer&#x27;);
        // toggle listeners
        if( isInfoLayerListening ) {
            removeImageInfoListeners();
            isInfoLayerListening = false;
        }
        else {
            addImageInfoListeners();
            isInfoLayerListening = true;
        }
    };
    
    // Private Methods
    // ---------------

    /**
     * Add image listeners.
     */
    function addImageInfoListeners()
    {
        view.addEventListener(&quot;wlchange&quot;, dwv.info.updateWindowingDiv);
        view.addEventListener(&quot;wlchange&quot;, dwv.info.updateMiniColorMap);
        view.addEventListener(&quot;wlchange&quot;, dwv.info.updatePlotMarkings);
        view.addEventListener(&quot;colorchange&quot;, dwv.info.updateMiniColorMap);
        view.addEventListener(&quot;positionchange&quot;, dwv.info.updatePositionDiv);
    }
    
    /**
     * Remove image listeners.
     */
    function removeImageInfoListeners()
    {
        view.removeEventListener(&quot;wlchange&quot;, dwv.info.updateWindowingDiv);
        view.removeEventListener(&quot;wlchange&quot;, dwv.info.updateMiniColorMap);
        view.removeEventListener(&quot;wlchange&quot;, dwv.info.updatePlotMarkings);
        view.removeEventListener(&quot;colorchange&quot;, dwv.info.updateMiniColorMap);
        view.removeEventListener(&quot;positionchange&quot;, dwv.info.updatePositionDiv);
    }
    
    /**
     * @private
     * The general-purpose event handler. This function just determines the mouse 
     * position relative to the canvas element.
     */
    function eventHandler(event)
    {
        // flag not to get confused between touch and mouse
        var handled = false;
        // Store the event position relative to the image canvas
        // in an extra member of the event:
        // event._x and event._y.
        if( mobile )
        {
            if( event.type === &quot;touchstart&quot; ||
                event.type === &quot;touchmove&quot;)
            {
                event.preventDefault();
                // If there&#x27;s one or two fingers inside this element
                if( event.targetTouches.length === 1 ||
                    event.targetTouches.length === 2)
                {
                  var touch = event.targetTouches[0];
                  // store
                  event._x = touch.pageX - parseInt(app.getImageLayer().getOffset().left, 10);
                  event._x = parseInt( (event._x / displayZoom), 10 );
                  event._y = touch.pageY - parseInt(app.getImageLayer().getOffset().top, 10);
                  event._y = parseInt( (event._y / displayZoom), 10 );
                  // second finger
                  if (event.targetTouches.length === 2) {
                      touch = event.targetTouches[1];
                      // store
                      event._x1 = touch.pageX - parseInt(app.getImageLayer().getOffset().left, 10);
                      event._x1 = parseInt( (event._x1 / displayZoom), 10 );
                      event._y1 = touch.pageY - parseInt(app.getImageLayer().getOffset().top, 10);
                      event._y1 = parseInt( (event._y1 / displayZoom), 10 );
                  }
                  // set handle event flag
                  handled = true;
                }
            }
            else if( event.type === &quot;touchend&quot; ) handled = true;
        }
        else
        {
            if( event.type === &quot;mousemove&quot; ||
                event.type === &quot;mousedown&quot; ||
                event.type === &quot;mouseup&quot; ||
                event.type === &quot;mouseout&quot; ||
                event.type === &quot;mousewheel&quot; ||
                event.type === &quot;dblclick&quot; ||
                event.type === &quot;DOMMouseScroll&quot; )
            {
                // layerX is for firefox
                event._x = event.offsetX === undefined ? event.layerX : event.offsetX;
                event._x = parseInt( (event._x / displayZoom), 10 );
                event._y = event.offsetY === undefined ? event.layerY : event.offsetY;
                event._y = parseInt( (event._y / displayZoom), 10 );
                // set handle event flag
                handled = true;
            }
            else if( event.type === &quot;keydown&quot; ) handled = true;
        }
            
        // Call the event handler of the tool.
        if( handled )
        {
            var func = self.getToolBox().getSelectedTool()[event.type];
            if( func )
            {
                func(event);
            }
        }
    }
    
    /**
     * @private
     * */
    function handleError(error)
    {
        if( error.name &amp;&amp; error.message) alert(error.name+&quot;: &quot;+error.message+&quot;.&quot;);
        else alert(&quot;Error: &quot;+error+&quot;.&quot;);
        if( error.stack ) console.log(error.stack);
    }
    
    /**
     * @private
     * @param dataWidth The width of the input data.
     * @param dataHeight The height of the input data.
     */
    function createLayers(dataWidth, dataHeight)
    {
        // resize app
        self.resize();
        
        // image layer
        imageLayer = new dwv.html.Layer(&quot;imageLayer&quot;);
        imageLayer.initialise(dataWidth, dataHeight);
        imageLayer.fillContext();
        imageLayer.setStyleDisplay(true);
        // draw layer
        drawLayer = new dwv.html.Layer(&quot;drawLayer&quot;);
        drawLayer.initialise(dataWidth, dataHeight);
        drawLayer.setStyleDisplay(true);
        // temp layer
        tempLayer = new dwv.html.Layer(&quot;tempLayer&quot;);
        tempLayer.initialise(dataWidth, dataHeight);
        tempLayer.setStyleDisplay(true);
    }
    
    /**
     * @private
     * Create the DICOM tags table.
     * @param dataInfo The data information.
     * To be called once the DICOM has been parsed.
     */
    function createTagsTable(dataInfo)
    {
        // tag list table (without the pixel data)
        if(dataInfo.PixelData) dataInfo.PixelData.value = &quot;...&quot;;
        // HTML node
        var node = document.getElementById(&quot;tags&quot;);
        // remove possible previous
        while (node.hasChildNodes()) { 
            node.removeChild(node.firstChild);
        }
        // tags HTML table
        var table = dwv.html.toTable(dataInfo);
        table.id = &quot;tagsTable&quot;;
        table.className = &quot;tagsList table-stripe&quot;;
        table.setAttribute(&quot;data-role&quot;, &quot;table&quot;);
        table.setAttribute(&quot;data-mode&quot;, &quot;columntoggle&quot;);
        // search form
        node.appendChild(dwv.html.getHtmlSearchForm(table));
        // tags table
        node.appendChild(table);
    }
    
    /**
     * @private
     * To be called once the DICOM has been parsed.
     */
    function postLoadInit(data)
    {
        // only initialise the first time
        if( view ) return;
        
        // get the view from the loaded data
        view = data.view;
        // create the DICOM tags table
        createTagsTable(data.info);
        // store image
        originalImage = view.getImage();
        image = originalImage;
        
        // layout
        dataWidth = image.getSize().getNumberOfColumns();
        dataHeight = image.getSize().getNumberOfRows();
        createLayers(dataWidth, dataHeight);
        
        // create the info layer
        dwv.info.createWindowingDiv();
        dwv.info.createPositionDiv();
        dwv.info.createMiniColorMap();
        dwv.info.createPlot();

        // get the image data from the image layer
        imageData = self.getImageLayer().getContext().createImageData( 
                dataWidth, dataHeight);

        // mouse listeners
        tempLayer.getCanvas().addEventListener(&quot;mousedown&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;mousemove&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;mouseup&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;mouseout&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;mousewheel&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;DOMMouseScroll&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;dblclick&quot;, eventHandler, false);
        // touch listeners
        tempLayer.getCanvas().addEventListener(&quot;touchstart&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;touchmove&quot;, eventHandler, false);
        tempLayer.getCanvas().addEventListener(&quot;touchend&quot;, eventHandler, false);
        // keydown listener
        window.addEventListener(&quot;keydown&quot;, eventHandler, true);
        // image listeners
        view.addEventListener(&quot;wlchange&quot;, app.generateAndDrawImage);
        view.addEventListener(&quot;colorchange&quot;, app.generateAndDrawImage);
        view.addEventListener(&quot;slicechange&quot;, app.generateAndDrawImage);
        addImageInfoListeners();
        
        // initialise the toolbox
        toolBox.enable(true);
        // add the HTML for the history 
        dwv.gui.appendUndoHtml();
        
        // the following has to be done after adding listeners
        
        // set window/level: triggers first data and div display
        dwv.tool.updateWindowingData(
                parseInt(app.getView().getWindowLut().getCenter(), 10),
                parseInt(app.getView().getWindowLut().getWidth(), 10) );
        // default position: triggers div display
        dwv.tool.updatePostionValue(0,0);
    }
    
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
